<!--

=========================================================
* Argon Dashboard - v1.1.2
=========================================================

* Product Page: https://www.creative-tim.com/product/argon-dashboard
* Copyright 2020 Creative Tim (https://www.creative-tim.com)
* Licensed under MIT (https://github.com/creativetimofficial/argon-dashboard/blob/master/LICENSE.md)

* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>
   CDP TEUB
  </title>
  <!-- Favicon -->
  <link href="./assets/img/brand/logo-teub.png" rel="icon" type="image/png">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
  <!-- Icons -->
  
  <link href="./assets/js/plugins/nucleo/css/nucleo.css" rel="stylesheet" />
  <link href="./assets/js/plugins/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet" />
  <!-- CSS Files -->
  <link href="./assets/css/argon-dashboard.css?v=1.1.2" rel="stylesheet" />
</head>

<body class="">
  <nav class="navbar navbar-vertical fixed-left navbar-expand-md navbar-light bg-white" id="sidenav-main">
    <div class="container-fluid">
      <!-- Toggler -->
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#sidenav-collapse-main" aria-controls="sidenav-main" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <!-- Brand -->
      <a class="navbar-brand pt-0" href="#">
        <img src="./assets/img/brand/logo_CDP.png" class="navbar-brand-img" alt="...">
      </a>
      <!-- User -->
     <ul class="nav align-items-center d-md-none">
       <!-- <li class="nav-item dropdown">
          <a class="nav-link nav-link-icon" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="ni ni-bell-55"></i>
          </a>
          <div class="dropdown-menu dropdown-menu-arrow dropdown-menu-right" aria-labelledby="navbar-default_dropdown_1">
            <a class="dropdown-item" href="#">Action</a>
            <a class="dropdown-item" href="#">Another action</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#">Something else here</a>
          </div>-->
        </li>
        <li class="nav-item dropdown">
          
          
        </li>
      </ul>
     
        
       
       
      </div>
    </div>
  </nav>
  <div class="main-content">
    <!-- Navbar -->
    <ul class="navbar-nav">
        
        <li class="nav-item">
          <a class="nav-link" href="gate.html">
            <i class="ni ni-key-25 text-info"></i> Kembali
          </a>
        </li>
        
      </ul>
    <!-- End Navbar -->
    <!-- Header -->
    <div class="header bg-gradient-primary pb-8 pt-5 pt-md-8">
      <div class="container-fluid">
        <div class="header-body">
          <!-- Card stats -->
          <div class="row">
         <div class="col-xl-3 col-lg-6">
              <div class="card card-stats mb-4 mb-xl-0">
                <div class="card-body">
                  <div class="row">
                    <div class="col">
                      <h5 class="card-title text-uppercase text-muted mb-0">Ethanol Rate</h5>
                      <span class="h2 font-weight-bold mb-0" id ="e-cons">cek</span>
                      <span class="h2 font-weight-bold mb-0">%</span>
                    </div>
                    <div class="col-auto">
                      <div class="icon icon-shape bg-danger text-white rounded-circle shadow">
                        <i class="fas fa-oil-can"></i>
                      </div>
                    </div>
                  </div>
                  
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-6">
              <div class="card card-stats mb-4 mb-xl-0">
                <div class="card-body">
                  <div class="row">
                    <div class="col">
                      <h5 class="card-title text-uppercase text-muted mb-0">Boiling Temperature</h5>
                      <span class="h2 font-weight-bold mb-0 temp" id ="b-temp">-</span>
                    </div>
                    <div class="col-auto">
                      <div class="icon icon-shape bg-warning text-white rounded-circle shadow">
                        <i class="fas fa-thermometer-full"></i>
                      </div>
                    </div>
                  </div>
                  
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-6">
              <div class="card card-stats mb-4 mb-xl-0">
                <div class="card-body">
                  <div class="row">
                    <div class="col">
                      <h5 class="card-title text-uppercase text-muted mb-0">Ethanol Temperature</h5>
                      <span class="h2 font-weight-bold mb-0 temp" id ="e-temp">-</span>
                    </div>
                    <div class="col-auto">
                      <div class="icon icon-shape bg-yellow text-white rounded-circle shadow">
                        <i class="fas fa-thermometer-quarter"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="col-xl-3 col-lg-6">
              <div class="card card-stats mb-4 mb-xl-0">
                <div class="card-body">
                  <div class="row">
                    <div class="col">
                      <h5 class="card-title text-uppercase text-muted mb-0">ineligible Switch</h5>
                    </div>
                    <div class="col-auto">
                      
                      </div>
                      <div class="col-auto">
                        <div class="icon icon-shape text-white rounded-circle bg-gray bg-yellow shadow" id="in-lamp">
                          <i class="fas fa-lightbulb"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            <div class="col-xl-3 col-lg-6">
              <div class="card card-stats mb-4 mb-xl-0">
                <div class="card-body">
                  <div class="row">
                    <div class="col">
                      <h5 class="card-title text-uppercase text-muted mb-0" >eligible Switch</h5>
                    </div>
                    <div class="col-auto">
                      
                      </div>
                      <div class="col-auto">
                        <div class="icon icon-shape text-white rounded-circle bg-gray bg-yellow shadow" id="el-lamp">
                          <i class="fas fa-lightbulb"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

<!--!chart mulai-->
   <div class="container-fluid mt--7">
      <div class="row kode ">
        <div class="col-xl-8 mb-2 mb-xl-0  ">
          
          

          <div class="card bg-gradient-default shadow">
            <div class="card-header bg-transparent">
              <div class="row align-items-center">
                <div class="col">
                  <h6 class="text-uppercase text-light ls-1 mb-1">Overview</h6>
                  <h2 class="text-white mb-0">Record Value</h2>
                </div>
                <div class="col">
                  <ul class="nav nav-pills justify-content-end">
                    <li class="nav-item mr-2 mr-md-0 diagram" data-toggle="chart" data-target="#chart-sales" data-update='{"data":{"labels":[],"datasets":[{"data":[]}]}}' data-prefix= " " data-suffix="%" > <!--'{"data":{"labels":[2,5,6]}} -->
                      <a href="#" class="nav-link py-2 px-3 active" data-toggle="tab" id="diagramClick">
                        <span class="d-none d-md-block">Ethanol</span>
                        <span class="d-md-none">Eth</span>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="card-body">
              <!-- Chart -->
              <div class="chart">
          <!--     Chart wrapper -->
                <canvas id="chart-sales" class="chart-canvas"></canvas>
              </div>
            </div>
          </div>

          
        </div>
      
      </div>
      <!-- Footer -->
      <footer class="footer">
        <!--<div class="row align-items-center justify-content-xl-between">
          <div class="col-xl-6">
            <div class="copyright text-center text-xl-left text-muted">
              &copy; 2018 <a rel="noopener" href="https://www.creative-tim.com" class="font-weight-bold ml-1" target="_blank">Creative Tim</a>
            </div>
          </div>
          <div class="col-xl-6">
            <ul class="nav nav-footer justify-content-center justify-content-xl-end">
              <li class="nav-item">
                <a href="https://www.creative-tim.com" class="nav-link" target="_blank" rel="noopener">Creative Tim</a>
              </li>
              <li class="nav-item">
                <a  rel="noopener" href="https://www.creative-tim.com/presentation" class="nav-link" target="_blank">About Us</a>
              </li>
              <li class="nav-item">
                <a href="http://blog.creative-tim.com" class="nav-link" target="_blank"  rel="noopener">Blog</a>
              </li>
              <li class="nav-item">
                <a  rel="noopener" href="https://github.com/creativetimofficial/argon-dashboard/blob/master/LICENSE.md" class="nav-link" target="_blank">MIT License</a>
              </li>
            </ul>
          </div>
        </div>-->
      </footer>
    </div>
  </div>
  <!--   Core   -->
  <script src="./assets/js/plugins/jquery/dist/jquery.min.js"></script>
  <script src="./assets/js/plugins/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <!--   Optional JS   -->
  <script src="./assets/js/plugins/chart.js/dist/Chart.min.js"></script>
  <script src="./assets/js/plugins/chart.js/dist/Chart.extension.js"></script>
  <!--   Argon JS   -->
  <script src="./assets/js/argon-dashboard.min.js?v=1.1.2"></script>
  <script src="https://cdn.trackjs.com/agent/v3/latest/t.js"></script>
  <script>
    window.TrackJS &&
      TrackJS.install({
        token: "ee6fab19c5a04ac1a32a645abde4613a",
        application: "argon-dashboard-free"
      });

      let startTime, timerInterval,pausedTime
      let recordedTimes = [];
      let recordedNumber =[];
      let xchart = [];
      let ychart =[];
// Fungsi untuk mengubah format waktu ke HH:MM:SS
function formatTime(timeInSeconds) {
  let hours = Math.floor(timeInSeconds / 3600);
  let minutes = Math.floor((timeInSeconds % 3600) / 60);
  let seconds = timeInSeconds % 60;

  return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

  function updateTimer() {
  const currentTime = Math.floor((Date.now() - startTime) / 1000);
  document.getElementById('timer').innerHTML = formatTime(currentTime);
}

      const bulbFeature = (elements, targets) => {
        if(targets){
            elements.classList.add('bg-yellow');
            elements.classList.remove('bg-gray');
        }else {
            elements.classList.add('bg-gray');
            elements.classList.remove('bg-yellow');
        }
      }
      const fetch_post = (data) => {
        // Buat permintaan PUT ke API untuk mengubah data di database
        fetch("https://rest-cdp-sunob45tza-et.a.run.app/api/data/d82K9kQOP13eUbNaPRxt", {
        method: "POST",
        headers: {
        "Content-Type": "application/json",
       },
        body: JSON.stringify(data),
         })
        .then(response => {
        if (response.ok) {
          console.log("Database berhasil diperbarui");
        } else {
          console.error("Gagal memperbarui database.");
          // Jika gagal, kembalikan kondisi checkbox ke kondisi sebelumnya
          
        }
            })
          .catch(error => {
           console.error("Terjadi kesalahan:", error);
        });
      }


      function fetchGetData() {
            // Ganti URL dengan URL RESTful API yang sesuai
            fetch("https://rest-cdp-sunob45tza-et.a.run.app/api/data")
                .then(response => response.json())
                .then(data => {
                    const boilTempElement = document.getElementById('b-temp');
                    const ethconsElement = document.getElementById('e-cons');
                    const ethTempElement = document.getElementById('e-temp');
                    const inLampElement = document.getElementById('in-lamp');
                    const elLampElement = document.getElementById('el-lamp');
                    const diagramElement = document.querySelector('.diagram');
                    if (data.length > 0) {
                        const latestData = data[data.length - 1];
                        const boilTemp = latestData['boil-temp'];
                        const ethcons = latestData['eth-sen'];
                        const ethTemp = latestData['sen-temp'];
                        const inLamp = latestData['inSwt'];
                        const elLamp = latestData['eliSwt'];
                        let timer = latestData['times'];
                        let valueY = latestData['value'];
                        boilTempElement.textContent = boilTemp;
                        ethconsElement.textContent = ethcons;
                        ethTempElement.textContent = ethTemp;
                        xchart = timer;
                        ychart = valueY;
                        
                        
                        
                        bulbFeature(inLampElement, inLamp);
                        bulbFeature(elLampElement, elLamp);
                        if(startTime>0 && pausedTime==null)
                        {
                          const currentTime = Math.floor((Date.now() - startTime) / 1000);
                          recordedTimes.push(formatTime(currentTime));
                          recordedNumber.push(ethcons);
                          console.log(recordedTimes);
                          console.log(recordedNumber);
                        }else if(pausedTime>0){
                          console.log(recordedNumber.length);
                        }
                    } else {
                        boilTempElement.textContent = '-';
                        ethconsElement.textContent = '-';
                        ethTempElement.textContent = '-';
                    }
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }

        // Panggil fetchData setiap beberapa detik (misalnya, setiap 5 detik)
    setInterval(fetchGetData, 1500);
        
        // Panggil fetchData saat halaman dimuat
    fetchGetData();

    

    
  document.getElementById('diagramClick').addEventListener('click',function(event){
    event.preventDefault();
 
                         let newData= {
                          data: {
                               labels: xchart , // New values for labels
                                datasets: [{
                                  data: ychart // New values for datasets
                                }]
                              },
                              prefix: '', // Updated prefix if needed
                              suffix: '%' // Updated suffix if needed

                        };
                        document.querySelector('.diagram').setAttribute('data-update',JSON.stringify(newData));
                        
                        console.log(xchart);
                        console.log(ychart);
  });

  </script>
</body>

</html>